
@{
    ViewBag.Title = "CREACIÓN DATOS CHATBOT";
    Layout = "~/Views/Shared/_LayoutECOPETROL.cshtml";
}


<div class="container">
    <div class="panel panel-default">
        <div class="panel-heading">
            <strong class="text-primary_asalud">PROCESOS</strong>
        </div>
        <form id="formularioIngresoProcesos">
            <div class="panel-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <input type="radio" id="procesosNuevos" name="tipoProceso" onclick="MostrarProcesos(2)" />
                        <label for="procesosNuevos" class="text-secondary_asalud">Proceso nuevo</label>
                        <input type="radio" id="procesosAntiguos" name="tipoProceso" onclick="MostrarProcesos(1)" />
                        <label for="procesosAntiguos" class="text-secondary_asalud">Proceso antiguo</label>
                    </div>

                    <div class="col-md-6" id="divProcesosAntiguos" style="display:none">
                        <label class="text-secondary_asalud">Procesos</label>
                        <select id="proceso" name="proceso" class="form-control select2" onchange="CargarSubProcesos(this.value)" required>
                            <option value="">--Seleccione--</option>
                        </select>
                    </div>

                    <div class="col-md-6" id="divProcesosNuevos" style="display:none">
                        <div class="col-md-8">
                            <label class="text-secondary_asalud">Proceso</label>
                            <input type="text" class="form-control" id="procesoNuevo" name="procesoNuevo" maxlength="199" required />
                        </div>
                        <br />

                        <div class="col-md-4">
                            <a class="btn button_Asalud_Guardar" onclick="ValidarIngresoProcesos()">Guardar</a>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </div>
    <br />

    <div class="panel panel-default">
        <div class="panel-heading">
            <strong class="text-primary_asalud">SUB PROCESOS</strong>
        </div>
        <form id="formularioIngresoSubProcesos">
            <div class="panel-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <input type="radio" id="subprocesosNuevos" name="tiposubProceso" onclick="MostrarSubProcesos(2)" />
                        <label for="subprocesosNuevos" class="text-secondary_asalud">Sub proceso nuevo</label>
                        <input type="radio" id="subprocesosAntiguos" name="tiposubProceso" onclick="MostrarSubProcesos(1)" />
                        <label for="subprocesosAntiguos" class="text-secondary_asalud">Sub proceso antiguo</label>
                    </div>


                    <div class="col-md-6" id="divSubProcesosAntiguos" style="display:none">

                        <label class="text-secondary_asalud">Sub procesos</label>
                        <select id="subProceso" name="subProceso" class="form-control select2" onchange="CargarPreguntas(this.value)" required>
                            <option value="">--Seleccione--</option>
                        </select>
                    </div>

                    <div class="col-md-6" id="divSubProcesosNuevos" style="display:none">
                        <div class="col-md-8">
                            <label class="text-secondary_asalud">Sub procesos</label>
                            <input type="text" class="form-control" id="subprocesoNuevo" name="subprocesoNuevo" maxlength="199" required />
                        </div>
                        <br />

                        <div class="col-md-4">
                            <a class="btn button_Asalud_Guardar" onclick="ValidarIngresoSubProcesos()">Guardar</a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <br />

    <div class="panel panel-default">
        <div class="panel-heading">
            <strong class="text-primary_asalud">PREGUNTAS</strong>
        </div>
        <form id="formularioIngresoPreguntas">
            <div class="panel-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <input type="radio" id="preguntasNuevas" name="preguntas" onclick="MostrarPreguntas(2)" />
                        <label for="preguntasNuevas" class="text-secondary_asalud">Pregunta nueva</label>
                        <input type="radio" id="preguntasAntiguas" name="preguntas" onclick="MostrarPreguntas(1)" />
                        <label for="preguntasAntiguas" class="text-secondary_asalud">Preguntas antiguas</label>
                    </div>

                    <div class="col-md-6" id="divPreguntasAntiguas" style="display:none">
                        <label class="text-secondary_asalud">Preguntas</label>
                        <select id="preguntas" name="preguntas" class="form-control select2" onchange="MostrarBotonGuardarRespuesta(this.value)" required>
                            <option value="">--Seleccione--</option>
                        </select>
                    </div>

                    <div class="col-md-6" id="divPreguntasNuevas" style="display:none">
                        <div class="col-md-8">
                            <label class="text-secondary_asalud">Pregunta</label>
                            <input type="text" class="form-control" id="preguntaNueva" name="preguntaNueva" maxlength="199" required />
                        </div>
                        <br />

                        <div class="col-md-4">
                            <a class="btn button_Asalud_Guardar" onclick="ValidarIngresoPreguntas()">Guardar</a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <strong class="text-primary_asalud">RESPUESTAS</strong>
        </div>
        <form id="formularioRespuestas">
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-3">
                        <label class="text-secondary_asalud">Tipo respuesta</label>
                        <select id="tipoRespuesta" name="tipoRespuesta" class="form-control select2" onchange="MostrarTipoAchivo(this.value)" required>
                            <option value="">--Seleccione--</option>
                            <option value="1">Abierta</option>
                            <option value="2">Cerrada</option>
                        </select>
                    </div>

                    <div class="col-md-3" id="divTipoArchivo" style="display:none;">
                        <label class="text-secondary_asalud">Tipo archivo</label>
                        <select id="tipoArchivo" name="tipoArchivo" class="form-control select2" required>
                            <option value="">--Seleccione--</option>
                            <option value="1">Imagen</option>
                            <option value="2">PDF</option>
                            @*<option value="3">Formatos</option>*@
                        </select>
                    </div>

                    <div class="col-md-3" id="divArchivo" style="display:none;">
                        <label class="text-secondary_asalud">Archivo</label>
                        <input type="file" id="files" name="files" class="form-control" onchange="ValidarArchivos();" multiple required />
                    </div>

                    <div class="col-md-3">
                        <label class="text-secondary_asalud">Respuesta</label>
                        <textarea maxlength="4999" class="form-control" id="respuesta" name="respuesta" required></textarea>
                    </div>
                </div>
                <br />
                <br />

                <div class="row" id="divGuardar" style="display:none;">
                    <div class="col-md-12 text-center">
                        <a class="btn button_Asalud_Guardar" onclick="ValidarIngresoRespuesta()">Guardar</a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>


<script src="~/Scripts/validate.js"></script>

<script>

    $(document).ready(function () {
        $('.solo-numeros').keyup(function () {
            this.value = (this.value + '').replace(/[^0-9.]/g, '');
        });

        $('.select2').select2({
            width: '100%',
            height: '100%'
        });
    });

    function ValidarArchivos() {

        var tipoArchivo = $("#tipoArchivo").val();
        if (tipoArchivo == null || tipoArchivo == "") {
            alert("primero seleccione el tipo de archivo");
            $("#files").val("");
        }

        var data = document.getElementById('files');
        var distintosArchivos = data.files;
        var contador = 0;

        for (contador; contador < distintosArchivos.length; contador++) {

            var nameext = data.files[contador].name;
            var extension = getfilesExtension3(nameext);

            if (tipoArchivo == 1) {
                var listaextensiones = ["png", "jpg", "jpeg", "Png", "Jpg", "Jpeg", "PNG", "JPG", "JPEG"];
            }
            else if (tipoArchivo == 2) {
                var listaextensiones = ["pdf", "Pdf", "PDF"];
            }
            else {
                var listaextensiones = ["xlsx", "xlsm", "xls", "Xlsx", "Xlsm", "Xls", "XLSX", "XLSM", "XLS"];
            }

            var valida = false;

            jQuery.each(listaextensiones, function (i, val) {
                if (extension == val) {
                    valida = true;
                }
            });

            if (valida == false) {
                alert("La extensión " + extension + " no es válida. Por favor, solo subir archivos del tipo seleccionado.");
                $("#files").val("");
            }
        }
    }

    function getfilesExtension3(filesname) {
        return filesname.slice((filesname.lastIndexOf(".") - 1 >>> 0) + 2);
    }

    function CargarProcesos(proyecto, idProceso) {
        $.ajax({
            url: "@Url.Action("ObtenerProcesos")",
            type: "POST",
            data: {
                proyecto: proyecto,
            },
            method: "POST",
            success: function (data) {
                $("#proceso").empty();
                $("#proceso").html(data);
                $("#proceso").val("").trigger("change");

                if (idProceso != 0 && idProceso != null) {
                    $("#proceso").val(idProceso).trigger("change");
                }
            }
        })
    }

    function CargarSubProcesos(proceso, idSubProceso) {

        $.ajax({
            url: "@Url.Action("ObtenerSubProcesos")",
            type: "POST",
            data: {
                proceso: proceso,
            },
            method: "POST",
            success: function (data) {
                $("#subProceso").empty();
                $("#subProceso").html(data);
                $("#subProceso").val("").trigger("change");

                if (idSubProceso != 0 && idSubProceso != null) {
                    $("#subProceso").val(idSubProceso).trigger("change");
                }
            }
        })
    }

    function CargarPreguntas(subProceso, idPregunta) {
        $.ajax({
            url: "@Url.Action("ObtenerPreguntas")",
            type: "POST",
            data: {
                subProceso: subProceso,
            },
            method: "POST",
            success: function (data) {
                $("#preguntas").empty();
                $("#preguntas").html(data);
                $("#preguntas").val("").trigger("change");

                if (idPregunta != 0 && idPregunta != null) {
                    $("#preguntas").val(idPregunta).trigger("change");
                }
            }
        })
    }

    function MostrarProcesos(opcion) {

        //Antiguo
        if (opcion == 1) {
            document.getElementById("divProcesosAntiguos").style.display = "block";
            document.getElementById("divProcesosNuevos").style.display = "none";
            CargarProcesos(1);
        }

        //Nuevo
        else {
            document.getElementById("divProcesosAntiguos").style.display = "none";
            document.getElementById("divProcesosNuevos").style.display = "block";
            CargarProcesos(0);

        }
    }

    function ValidarIngresoProcesos() {

        var validator = $("#formularioIngresoProcesos").validate();
        if (validator.form()) {

            var formData = new FormData($("#formularioIngresoProcesos")[0]);
            formData.append("procesoNuevo", $("#procesoNuevo").val());
            formData.append("proyecto", 1);

            LoadingShow();
            $.ajax({
                url: '@Url.Action("AgregarProcesoNuevo", "LecturaPdf")',
                data: formData,
                method: "POST",
                processData: false,
                contentType: false,

                success: function (response) {
                    LoadingHide();
                    alert(response.mensaje);
                    if (response.rta == 1) {
                        $('#procesosAntiguos').prop('checked', true);
                        MostrarProcesos(1);
                        CargarProcesos(1, response.idProceso);
                    }
                },
                error: function (xhr, status, error) {
                    LoadingHide();
                }
            });

        }
    }

    function MostrarSubProcesos(opcion) {

        var proceso = $("#proceso").val();

        //Antiguo
        if (opcion == 1) {
            document.getElementById("divSubProcesosAntiguos").style.display = "block";
            document.getElementById("divSubProcesosNuevos").style.display = "none";
            CargarSubProcesos(proceso);
        }

        //Nuevo
        else {
            document.getElementById("divSubProcesosAntiguos").style.display = "none";
            document.getElementById("divSubProcesosNuevos").style.display = "block";
        }
    }

    function ValidarIngresoSubProcesos() {

        var validator = $("#formularioIngresoSubProcesos").validate();
        if (validator.form()) {

            var peoceso = $("#proceso").val();

            var formData = new FormData($("#formularioIngresoSubProcesos")[0]);
            formData.append("subprocesoNuevo", $("#subprocesoNuevo").val());
            formData.append("proceso", $("#proceso").val());

            LoadingShow();
            $.ajax({
                url: '@Url.Action("AgregarSubProcesoNuevo", "LecturaPdf")',
                data: formData,
                method: "POST",
                processData: false,
                contentType: false,

                success: function (response) {
                    LoadingHide();
                    alert(response.mensaje);
                    if (response.rta == 1) {
                        $('#subprocesoAntiguo').prop('checked', true);
                        MostrarSubProcesos(1);
                        CargarSubProcesos(peoceso, response.idSubProceso);
                    }
                },
                error: function (xhr, status, error) {
                    LoadingHide();
                }
            });

        }
    }

    function MostrarPreguntas(opcion) {

        var subproceso = $("#subproceso").val();

        //Antiguo
        if (opcion == 1) {
            document.getElementById("divPreguntasAntiguas").style.display = "block";
            document.getElementById("divPreguntasNuevas").style.display = "none";
            CargarPreguntas(subproceso);
        }

        //Nuevo
        else {
            document.getElementById("divPreguntasAntiguas").style.display = "none";
            document.getElementById("divPreguntasNuevas").style.display = "block";
        }
    }

    function ValidarIngresoPreguntas() {

        var validator = $("#formularioIngresoPreguntas").validate();
        if (validator.form()) {

            var subproceso = $("#subProceso").val();

            var formData = new FormData($("#formularioIngresoPreguntas")[0]);
            formData.append("preguntaNueva", $("#preguntaNueva").val());
            formData.append("subProceso", $("#subProceso").val());

            LoadingShow();
            $.ajax({
                url: '@Url.Action("AgregarpreguntaNueva", "LecturaPdf")',
                data: formData,
                method: "POST",
                processData: false,
                contentType: false,

                success: function (response) {
                    LoadingHide();
                    alert(response.mensaje);
                    if (response.rta == 1) {
                        $('#subprocesoAntiguo').prop('checked', true);
                        MostrarPreguntas(1);
                        CargarPreguntas(subproceso, response.idPregunta);
                    }
                },
                error: function (xhr, status, error) {
                    LoadingHide();
                }
            });

        }
    }

    function MostrarTipoAchivo(tipoRespuesta) {

        //Abierta
        if (tipoRespuesta == 1) {
            document.getElementById("divTipoArchivo").style.display = "block";
            document.getElementById("divArchivo").style.display = "block";
        }
        //Cerrada
        else {
            document.getElementById("divTipoArchivo").style.display = "none";
            document.getElementById("divArchivo").style.display = "none";
        }
    }

    function MostrarBotonGuardarRespuesta(pregunta) {
        if (pregunta != null && pregunta != "") {
            document.getElementById("divGuardar").style.display = "block";
        } else {
            document.getElementById("divGuardar").style.display = "none";
        }
    }


    function ValidarIngresoRespuesta() {
        var validator = $("#formularioRespuestas").validate();
        if (validator.form()) {

            var idPregunta = $("#preguntas").val();

            var formData = new FormData($("#formularioIngresoPreguntas")[0]);
            formData.append("idPregunta", idPregunta);
            formData.append("tipoRespuesta", $("#tipoRespuesta").val());
            formData.append("tipoArchivo", $("#tipoArchivo").val());
            formData.append("respuesta", $("#respuesta").val());

            var archivos = $("#files")[0].files;

            for (var i = 0; i < archivos.length; i++) {
                formData.append("archivos", archivos[i]);
            }


            LoadingShow();
            $.ajax({
                url: '@Url.Action("GuardarCreacionRespuestas", "LecturaPdf")',
                data: formData,
                method: "POST",
                processData: false,
                contentType: false,

                success: function (response) {
                    LoadingHide();
                    alert(response.mensaje);
                    if (response.rta == 1) {
                        location.reload();
                    }
                },
                error: function (xhr, status, error) {
                    LoadingHide();
                }
            });
        }
    }

</script>

<style>
</style>