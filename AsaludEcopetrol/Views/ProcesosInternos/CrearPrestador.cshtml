@model ECOPETROL_COMMON.ENTIDADES.calidad_prestadores
@using Kendo.Mvc.UI;
@{
    if (Model.id_prestador == 0)
    {
        ViewBag.Title = "CREAR PRESTADOR";
    }
    else
    {
        ViewBag.Title = "EDITAR PRESTADOR";
    }

    Layout = "~/Views/Shared/_LayoutECOPETROL.cshtml";

}

<br />

<div class="panel panel-default">
    <div class="panel-heading">
        @if (Model.id_prestador == 0)
        {
            <strong class="panel-title text-primary_asalud">Complete el formulario para crear un nuevo prestador</strong>
        }
        else
        {
            <strong class="panel-title text-primary_asalud">Complete el formulario para editar el prestador</strong>
        }

    </div>
    <div class="panel-body">
        <form id="formprestador">
            <input type="hidden" name="id_prestador" id="id_prestador" value="@Model.id_prestador" />
            <div class="row">
                <div class="col-sm-4">
                    <div class="form-group">
                        <span class="control-label text-secondary_asalud " style="font-weight:bold">Regional</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="regional" required="required">
                            <option value="">Seleccione...</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_regional item in ViewBag.ref_regional)
                            {
                                if (Model.id_regional != 0)
                                {
                                    if (Model.id_regional == item.id_ref_regional)
                                    {
                                        <option selected="selected" value="@item.id_ref_regional">@item.nombre_regional</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id_ref_regional">@item.nombre_regional</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.id_ref_regional">@item.nombre_regional</option>
                                }

                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Razon Social</span><span style="color:red">*</span>
                        <input type="text" class="form-control sincaracteresespeciales" value="@Model.razon_social" name="razonsocial" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Tipo Contrato</span>
                        <input type="text" class="form-control sincaracteresespeciales" value="@Model.tipo_contrato" name="tipocontrato" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Telefono 1</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" value="@Model.telefono_1" name="telefono1" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Celular</span>
                        <input type="text" class="form-control solo-numero" value="@Model.celular" name="celular" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Pagina Web</span>
                        <input type="text" class="form-control" name="paginaweb" value="@Model.pagina_web" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Actividad Economica</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" name="actividad_economica" value="@Model.actividad_economica" required />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Clase Persona</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="clasepersona" required="required">
                            <option>- Seleccionar -</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_clase_persona item in ViewBag.ref_clase_persona)
                            {
                                if (Model.clase_persona != 0)
                                {
                                    if (Model.clase_persona == item.id_clase_persona)
                                    {
                                        <option selected="selected" value="@item.id_clase_persona">@item.descripcion</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id_clase_persona">@item.descripcion</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.id_clase_persona">@item.descripcion</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Población Capitada</span><span style="color:red"> (valido para contratos capitados)</span>
                        <input type="text" class="form-control solo-numero" name="poblacion_capitada" value="@Model.Poblacion_Capitada" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">No Contrato</span><span style="color:red">*</span>
                        <input type="text" class="form-control" name="nocontrato" value="@Model.num_contrato" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Especialidad</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="especialidad" required="required">
                            <option>- Seleccionar -</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.calidad_ref_especialidad item in ViewBag.refespecialidad)
                            {
                                if (Model.especialidad != null)
                                {
                                    if (Model.especialidad == item.id)
                                    {
                                        <option selected="selected" value="@item.id">@item.descripcion</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id">@item.descripcion</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.id">@item.descripcion</option>
                                }

                            }
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Cod Habilitacion</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" maxlength="12" name="codhabilitacion" value="@Model.cod_habilitacion" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Tipo Id Prestador</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="tipoidprestador" required="required">
                            <option value="">Seleccione...</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_tipo_documental item in ViewBag.ref_tipodocumental)
                            {
                                if (item.id_ref_tipo_documental.Contains("NIT") || item.id_ref_tipo_documental.Contains("CE") || item.id_ref_tipo_documental.Contains("CC"))
                                {
                                    if (!string.IsNullOrEmpty(Model.tipo_id_prestador))
                                    {
                                        if (Model.tipo_id_prestador.ToLower() == item.descripcion.ToLower())
                                        {
                                            <option selected="selected" value="@item.descripcion">@item.descripcion</option>
                                        }
                                        else
                                        {
                                            <option value="@item.descripcion">@item.descripcion</option>
                                        }
                                    }
                                    else
                                    {
                                        <option value="@item.descripcion">@item.descripcion</option>
                                    }
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Nombre Representante Legal</span><span style="color:red">*</span>
                        <input type="text" class="form-control sincaracteresespeciales" value="@Model.nom_representante_legal" name="nomrepresentante" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Telefono 2</span>
                        <input type="text" class="form-control solo-numero" value="@Model.telefono_2" name="telefono2" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Fax</span>
                        <input type="text" class="form-control solo-numero" value="@Model.fax" name="fax" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Nom Municipio</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="nom_municipio" id="nom_municipio" required="required" onchange="getidmuni()">
                            <option>- Seleccionar -</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_calidad_municipios item in ViewBag.ref_municipios)
                            {
                                if (Model.muni_dane != 0)
                                {
                                    if (Model.muni_dane == item.id_ref_calidad_mun)
                                    {
                                        <option selected="selected" value="@item.id_ref_calidad_mun">@item.Nom_Municipio</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id_ref_calidad_mun">@item.Nom_Municipio</option>
                                    }

                                }
                                else
                                {
                                    <option value="@item.id_ref_calidad_mun">@item.Nom_Municipio</option>
                                }

                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Régimen Tributario</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" required="required" name="regimen_tributario" id="regimen_tributario">
                            <option value="">- Seleccionar -</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.calidad_ref_regimen item in ViewBag.refRegimen)
                            {
                                if (Model.regimen_tributario != null)
                                {
                                    if (Model.regimen_tributario == item.id_regimen)
                                    {
                                        <option selected="selected" value="@item.id_regimen">@item.descripcion</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id_regimen">@item.descripcion</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.id_regimen">@item.descripcion</option>
                                }

                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="text-secondary_asalud" style="font-weight:bold;margin-top:7%">Autoretenedor</label><span style="color:red">*</span>
                        &nbsp;&nbsp;
                        <div class="btn-group">
                            <label class="btn btn-default">
                                @if (string.IsNullOrEmpty(Model.Autoretenedor))
                                {
                                    <input type="radio" checked="checked" id="autoretenedor1" name="autoretenedor1" value="SI" required="required" /> <span>SI</span>
                                }
                                else
                                {
                                    if (Model.Autoretenedor == "SI")
                                    {
                                        <input type="radio" checked="checked" id="autoretenedor1" name="autoretenedor1" value="SI" required="required" /> <span>SI</span>
                                    }
                                    else
                                    {
                                        <input type="radio" id="autoretenedor1" name="autoretenedor1" value="SI" required="required" /> <span>SI</span>
                                    }
                                }
                            </label>
                            <label class="btn btn-default">
                                @if (string.IsNullOrEmpty(Model.Autoretenedor))
                                {
                                    <input type="radio" id="autoretenedor2" name="autoretenedor1" value="NO" required="required" /> <span>NO</span>
                                }
                                else
                                {
                                    if (Model.Autoretenedor == "NO")
                                    {
                                        <input checked="checked" type="radio" id="autoretenedor2" name="autoretenedor1" value="NO" required="required" /><span>NO</span>
                                    }
                                    else
                                    {
                                        <input type="radio" id="autoretenedor2" name="autoretenedor1" value="NO" required="required" /> <span>NO</span>
                                    }
                                }

                            </label>
                        </div>
                        <input type="hidden" class="form-control" id="autoretenedor" name="autoretenedor" value="SI" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Días Ofertados</span><span style="color:red"> (valido para contratos capitados)</span>
                        <input type="text" class="form-control solo-numero" name="dias_ofertados" value="@Model.Días_Ofertados" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Fecha Inicio Contrato</span><span style="color:red">*</span>
                        <input class="datepicker" value="@Model.fecha_inicio_contrato" style="width: 100%" name="fechainiciocontrato" id="" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Tipo Prestador</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="tipoprestador" required="required">
                            <option value="">Seleecione</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.indicadores item in ViewBag.ref_tipoprestador)
                            {
                                if (Model.tipo_prestador != null)
                                {
                                    if (Model.tipo_prestador == item.id_indicador)
                                    {
                                        <option selected="selected" value="@item.id_indicador">@item.nom_indicador</option>
                                    }
                                    else
                                    {
                                        <option value="@item.id_indicador">@item.nom_indicador</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.id_indicador">@item.nom_indicador</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Cod Sap</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" name="codsap" value="@Model.cod_sap" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">No Id Prestador</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" value="@Model.no_id_prestador" name="noidprestador" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Dirección</span><span style="color:red">*</span>
                        <input type="text" class="form-control sincaracteresespeciales" value="@Model.direccion" name="direccion" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Telefono 3</span>
                        <input type="text" class="form-control solo-numero" value="@Model.telefono_3" name="telefono3" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Correo Electronico</span><span style="color:red">*</span>
                        <input type="text" class="form-control" name="correoelectronico" value="@Model.correo_electronico" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Id Muni Dane</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" readonly="readonly" name="idmunidane" id="idmunidane" value="@Model.id_muni_dane" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Ambito</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="ambito" required="required">
                            <option value="">Seleccione...</option>
                            @foreach (ECOPETROL_COMMON.ENTIDADES.Ref_analaisis_caso_ambito item in ViewBag.ref_ambito)
                            {
                                if (!string.IsNullOrEmpty(Model.ambito))
                                {
                                    if (Model.ambito.ToLower() == item.descripcion)
                                    {
                                        <option selected="selected" value="@item.descripcion">@item.descripcion</option>
                                    }
                                    else
                                    {
                                        <option value="@item.descripcion">@item.descripcion</option>
                                    }
                                }
                                else
                                {
                                    <option value="@item.descripcion">@item.descripcion</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Porcentaje ICA</span><span style="color:red">*</span>
                        <input type="text" class="form-control solo-numero" name="prcentaje_ica" value="@Model.Porcentaje_ICA" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Horas Ofertadas</span><span style="color:red"> (valido para contratos capitados)</span>
                        <input type="text" class="form-control solo-numero" name="horas_ofertadas" value="@Model.Horas_ofertadas" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Fecha Fin Contrato</span><span style="color:red">*</span>
                        <input class="datepicker" value="@Model.fecha_fin_contrato" style="width: 100%" name="fechafincontrato" required="required" />
                    </div>
                    <div class="form-group">
                        <span class="text-secondary_asalud" style="font-weight:bold">Tipo Localidad</span><span style="color:red">*</span>
                        <select class="form-control dropdownlist" style="width:100%" name="tipolocalidad" id="tipolocalidad" required="required">
                            <option value="">Seleecione</option>
                            <option value="Tipo I">Tipo 1</option>
                            <option value="Tipo II">Tipo 2</option>
                            <option value="Tipo III">Tipo 3</option>
                        </select>
                    </div>
                </div>
            </div>


            <div class="col-sm-12 text-center">
                <button class="btn button_Asalud_Guardar" type="button" onclick="ValidarFormulario()">Guardar Cambios</button>
                <a role="button" href="@Url.Action("CalidadPrestadores", "ProcesosInternos")" class="btn button_Asalud_Rechazar">Volver</a>
            </div>
        </form>
    </div>
</div>

<script src="~/Scripts/validate.js"></script>
<script>
    $(document).ready(function ()
    {
        var localidad = '@Model.tipo_localidad';
        if (localidad != '') {
            $("#tipolocalidad").val(localidad);
        }

        $(".datepicker").kendoDatePicker({
            format: "MM/dd/yyyy"
        });


        $('.dropdownlist').select2({
            width: '100%'
        });


        $('.sincaracteresespeciales').keyup(function () {
            this.value = (this.value + '').replace(/[^0-9a-zA-Z.,' ']/g, '');
        });

        $("#autoretenedor1").change(function () {
            if ($(this).is(':checked')) {
                $("#autoretenedor").val("SI");
            } else {
                $("#autoretenedor").val("NO");
            }
        })

        $("#autoretenedor2").change(function () {
            if ($(this).is(':checked')) {
                $("#autoretenedor").val("NO");
            } else {
                $("#autoretenedor").val("SI");
            }
        })
    })

    function getidmuni() {
        var value = $("#nom_municipio").val();
        if (value != "") {
            $.ajax({

                url: "@Url.Action("ObtenerCodMun")",
                data: { id_mun: value },
                type: "post",
                success: function (data) {
                    $("#idmunidane").val(data);
                }
            });
        }
    }

    function ValidarFormulario() {
        hasChangue = false;
        var validator = $("#formprestador").validate({
            message: 'Este campo es obligatorio*'
        });
        if (validator.form())
        {
                LoadingShow();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("PostCrearPrestador")",
                    data: {
                        formulario: $("#formprestador").serialize()
                    },
                    success: function (data) {
                        var title = "";
                        var text = "";
                        var icon = "";

                        if (data.idrta == 0) {
                            title = "Prestador agregado exitosamente!";
                            text = "El prestador ha sido creado exitosamente.";
                            icon = "success";
                        }
                        else {
                            title = "El prestador no ha sido creado";
                            text = data.mensaje;
                            icon = "danger";
                        }

                        LoadingHide();

                        Swal.fire({
                            title: title,
                            text: text,
                            icon: icon,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Aceptar'
                        }).then((result) => {
                            if (result.value) {
                                if (data.idrta == 0) {
                                    var url = "@Url.Action("CalidadPrestadores", "ProcesosInternos")";
                                    location.href = url;
                                }
                            }
                        })
                    },
                    error: function (data) {
                        LoadingHide();
                        alert(data);
                    }
                });
        }
    }
</script>

<style>
    #div1 {
        overflow: scroll;
        height: 200px;
    }

    label.error {
        color: white;
        float: right;
    }

    #pnlcargararchivo {
        margin-top: 5%;
    }

    .Info {
        color: #800000;
        text-align: justify;
        font-weight: bold;
    }

    .Error {
        color: #800000;
        font-size: small;
        font-weight: bold;
    }

    .Tamaño {
        height: 200px;
    }

    .TamañoImag {
        height: 200px;
        position: center;
    }

    .TamañoDiv {
        position: page;
        /*width:1100px;*/
    }

    .btn-glyphicon {
        padding: 8px;
        background: #ffffff;
        margin-right: 4px;
    }

    .icon-btn {
        padding: 1px 15px 3px 2px;
        border-radius: 50px;
    }
</style>
